"use strict";(self.webpackChunkencyclofus=self.webpackChunkencyclofus||[]).push([[25,898],{1221:(t,e,n)=>{n.d(e,{Z:()=>l});var s=n(8081),a=n.n(s),i=n(3645),o=n.n(i)()(a());o.push([t.id,"map {\n  width: 100%;\n}\nsvg {\n  width: 100%;\n  height: 100%;\n}\nmap text {\n  font: 13px noserif;\n  fill: var(--bs-body-color);\n  pointer-events: none;\n}\n.mapcontainer {\n  width: 1004.58946839px;\n  height: 820px;\n  margin-left: auto;\n  margin-right: auto;\n}\n.floor {\n  stroke: #a69e93;\n}\n.floor.k0 {\n  fill: #9d9588;\n}\n.floor.k1 {\n  fill: #988f82;\n}\n.floor:hover {\n  fill: #b87f49;\n}\n.hole {\n  fill: rgba(0, 0, 0, 0);\n}\n.block {\n  fill: rgba(59, 66, 68, 0.7);\n  stroke: #a69e93;\n}\n.object {\n  fill: rgba(126, 65, 65, 0.7);\n  stroke: #a69e93;\n}\n.blue {\n  fill: #0000ff;\n}\n.red {\n  fill: #ff0000;\n}\n.target {\n  fill: #ff00ff;\n}\n.highlight {\n  fill: rgba(92, 129, 70, 0.664);\n}\n.s1 {\n  fill: #ea00ff;\n}\n.s2 {\n  fill: #00ffb3;\n}\n.s3 {\n  fill: #e5ff00;\n}\n",""]);const l=o},3132:(t,e,n)=>{n.d(e,{Z:()=>l});var s=n(8081),a=n.n(s),i=n(3645),o=n.n(i)()(a());o.push([t.id,"maplist .btn {\n  border-width: 0 !important;\n  border-radius: 0 !important;\n}\nmaplist .radioDark:hover {\n  color: var(--bs-btn-hover-color);\n  background-color: var(--bs-btn-hover-bg);\n}\n",""]);const l=o},1898:(t,e,n)=>{n.r(e),n.d(e,{Map:()=>H});var s={};n.r(s),n.d(s,{default:()=>M,dependencies:()=>x,name:()=>v,register:()=>N,template:()=>y});var a=n(655),i=(n(1932),n(1542)),o=n(3379),l=n.n(o),r=n(7795),d=n.n(r),h=n(569),c=n.n(h),p=n(3565),b=n.n(p),u=n(9216),g=n.n(u),m=n(4589),f=n.n(m),k=n(1221),w={};w.styleTagTransform=f(),w.setAttributes=b(),w.insert=c().bind(null,"head"),w.domAPI=d(),w.insertStyleElement=g(),l()(k.Z,w),k.Z&&k.Z.locals&&k.Z.locals;const v="map",y='\x3c!-- name + reset --\x3e\n<div class="d-flex">\n    <b style="vertical-align: middle;">${mapName}</b>\n    <button class="btn btn-outline-dark ms-auto" click.trigger="resetObjects()">Reset</button>\n</div>\n\n\x3c!-- spinner --\x3e\n<div show.bind="!mapLoaded" class="loaderContainer">\n    <div class="loader"></div>\n</div>\n\n\x3c!-- map --\x3e\n<div show.bind="mapLoaded" class="mapcontainer">\n    <svg ref="svg">\n        <g ref="groupFloor" class=""></g>\n    </svg>\n</div>\n\n\x3c!-- init --\x3e\n${init()}\n',M=y,x=[];let A;function N(t){A||(A=i.b_N.define({name:v,template:y,dependencies:x})),t.register(A)}var D=n(9344),j=n(1860),I=n(2013);const T=2*Math.sin(60*Math.PI/180)*40,C=2*Math.sin(30*Math.PI/180)*40,L=15;let H=class{constructor(t,e){this.ea=e,this.mapId="134479872",this.mapLoaded=!1,this.db=t,e.subscribe("db:loadmap",(t=>{if(this.initDone){let t=this.db.jsonMaps[this.mapId];this.board.cells=t.cells,this.generateMap()}else this.init()})),e.subscribe("db:loaded",(t=>{this.init()})),e.subscribe("map:setid",(t=>{if(this.mapId=t,this.db.jsonMaps[this.mapId]){let t=this.db.jsonMaps[this.mapId];this.board.cells=t.cells,this.generateMap()}else this.db.loadMap(this.mapId)}))}get mapName(){return this.db.getI18n("map_"+this.mapId)}init(){if(this.initDone)return"";if(!this.groupFloor)return"";if(!this.db.jsonMaps||!this.db.jsonMaps[this.mapId])return this.db.loadMap(this.mapId),"";this.groupFloor&&(this.groupFloor.innerHTML=""),this.board=new j.$l;let t=this.db.jsonMaps[this.mapId];return this.board.cells=t.cells,this.generateMap(),this.initDone=!0,""}load(){}placeObject(t){this.board.objects[t]=!this.board.objects[t],JSON.stringify(this.board.getCellCoordById(t)),JSON.stringify(this.board.getPos(t)),this.generateMap()}placeTarget(t){console.log("placeTarget "+t),this.board.target==t?this.board.target=-1:this.board.target=t,this.generateMap()}resetObjects(){this.board.objects.length=0,this.generateMap()}generateMap(){for(let t=0;t<this.board.cells.length;t++){let e=this.board.cells[t],n=this.board.getX(t),s=this.board.getY(t),a=s%2,i={i:n,j:Math.floor(s/2),k:a},o="k"+a+" ";if(this.board.objects[t])o+="object ",this.getPolygonBlock(t,i,o);else if(e.los){let n=!1;-1!=this.board.target&&(n=this.board.checkView(this.board.target,t)),!e.mov&&e.los?o+="hole ":this.board.target==t?o+="target ":n?o+="highlight ":e.blue?o+="blue ":e.red?o+="red ":o+="floor ",this.getPolygon(t,i,o)}else o+="block ",this.getPolygonBlock(t,i,o)}this.mapLoaded=!0}getPolygon(t,e,n){let s=e.i*T,a=e.j*C,i=s+e.k*T/2,o=a+C/2+e.k*C/2,l=s+T/2+e.k*T/2,r=a+e.k*C/2,d=s+T+e.k*T/2,h=a+C/2+e.k*C/2,c=s+T/2+e.k*T/2,p=a+C+e.k*C/2,b=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t of n.split(" "))t&&b.classList.add(t);b.onclick=e=>{n.includes("hole")||this.placeTarget(t)},b.oncontextmenu=e=>{e.preventDefault(),n.includes("hole")||this.placeObject(t)};let u="";u+=i+","+o+" ",u+=l+","+r+" ",u+=d+","+h+" ",u+=c+","+p,b.setAttribute("points",u);var g=document.createElementNS("http://www.w3.org/2000/svg","g");if(g.appendChild(b),-1!=this.board.target&&n.includes("highlight")){let e=this.board.getCellCoordById(t),n=this.board.getCellCoordById(this.board.target),s=Math.abs(e.x-n.x)+Math.abs(e.y-n.y),a=document.createElementNS("http://www.w3.org/2000/svg","text");a.textContent=s+"";let i=s>=10?7:3;a.setAttribute("x",l-i+""),a.setAttribute("y",r+20+3+""),g.appendChild(a)}this.initDone?this.groupFloor.children.item(t).replaceWith(g):this.groupFloor.appendChild(g)}getPolygonBlock(t,e,n){let s=e.i*T,a=e.j*C,i={x:s+e.k*T/2,y:a+C/2+e.k*C/2-L},o=s+T/2+e.k*T/2,l=a+e.k*C/2-L,r={x:s+T+e.k*T/2,y:a+C/2+e.k*C/2-L},d={x:s+T/2+e.k*T/2,y:a+C+e.k*C/2-L},h=i.x,c=i.y+L,p=d.x,b=d.y+L,u=r.x,g=r.y+L,m=document.createElementNS("http://www.w3.org/2000/svg","polygon"),f=document.createElementNS("http://www.w3.org/2000/svg","polygon"),k=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t of n.split(" "))t&&m.classList.add(t),t&&f.classList.add(t),t&&k.classList.add(t);let w=e=>{e.preventDefault(),n.includes("object")&&this.placeObject(t)};m.oncontextmenu=w,k.oncontextmenu=w,f.oncontextmenu=w;let v="";v+=i.x+","+i.y+" ",v+=o+","+l+" ",v+=r.x+","+r.y+" ",v+=d.x+","+d.y+" ",m.setAttribute("points",v),v=p+","+b+" ",v+=h+","+c+" ",v+=i.x+","+i.y+" ",v+=d.x+","+d.y+" ",f.setAttribute("points",v),v=p+","+b+" ",v+=u+","+g+" ",v+=r.x+","+r.y+" ",v+=d.x+","+d.y+" ",k.setAttribute("points",v);var y=document.createElementNS("http://www.w3.org/2000/svg","g");y.appendChild(m),y.appendChild(f),y.appendChild(k),this.initDone?this.groupFloor.childNodes.item(t).replaceWith(y):this.groupFloor.appendChild(y)}};H=(0,a.gn)([(0,i.MoW)(s),(0,D.f3)(I.db),(0,a.fM)(1,D.Rp),(0,a.w6)("design:paramtypes",[I.db,Object])],H)},1025:(t,e,n)=>{n.r(e),n.d(e,{MapList:()=>C});var s={};n.r(s),n.d(s,{default:()=>x,dependencies:()=>A,name:()=>y,register:()=>D,template:()=>M});var a=n(655),i=(n(1932),n(1542)),o=n(3379),l=n.n(o),r=n(7795),d=n.n(r),h=n(569),c=n.n(h),p=n(3565),b=n.n(p),u=n(9216),g=n.n(u),m=n(4589),f=n.n(m),k=n(3132),w={};w.styleTagTransform=f(),w.setAttributes=b(),w.insert=c().bind(null,"head"),w.domAPI=d(),w.insertStyleElement=g(),l()(k.Z,w),k.Z&&k.Z.locals&&k.Z.locals;var v=n(1898);const y="maplist",M='\n\n<div if.bind="isLoaded">\n    <div class="btn-group" style="" role="group" aria-label="Basic radio toggle button group">\n        <input type="radio" class="btn-check" name="btnradioa" id="btnGoultar" autocomplete="off" checked click.delegate="clickGoultar()">\n        <label class="btn btn-outline-dark radioDark" for="btnGoultar" t="maps.goultar"></label>\n\n        <input type="radio" class="btn-check" name="btnradioa" id="btnTournoi" autocomplete="off" click.delegate="clickTournoi()">\n        <label class="btn btn-outline-dark radioDark" for="btnTournoi" t="maps.tournament"></label>\n\n        <input type="radio" class="btn-check" name="btnradioa" id="btnDuel" autocomplete="off" click.delegate="clickDuel()">\n        <label class="btn btn-outline-dark radioDark" for="btnDuel" t="maps.duel"></label>\n        \n        <input type="radio" class="btn-check" name="btnradioa" id="btnAmakna" autocomplete="off" click.delegate="clickAmakna()">\n        <label class="btn btn-outline-dark radioDark" for="btnAmakna" t="maps.amakna"></label>\n\n        <input type="radio" class="btn-check" name="btnradioa" id="btnHelp" autocomplete="off" click.delegate="clickHelp()">\n        <label class="btn btn-outline-dark radioDark ms-auto" style="" for="btnHelp" t="help"></label>\n    </div>\n\n    <div show.bind="showHelp">\n        <span style="padding-left: 12px;" t="maps.clickl"></span> \n        <br/>  \n        <span style="padding-left: 12px;" t="maps.clickr"></span>\n    </div>\n\n    <hr>\n\n    <div show.bind="showGoultar">\n        <button class="btn btn-outline-dark" repeat.for="id of goultars" click.trigger="select(id)">${getMapName(id)}</button>\n    </div>\n\n    <div show.bind="showTournoi">\n        <button class="btn btn-outline-dark" repeat.for="id of tournois" click.trigger="select(id)">${getMapName(id)}</button>\n    </div>\n\n    <div show.bind="showDuel">\n        <button class="btn btn-outline-dark" repeat.for="id of duels" click.trigger="select(id)">${getMapName(id)}</button>\n    </div>\n    \n    <div show.bind="showAmakna">\n        <button class="btn btn-outline-dark" repeat.for="id of amaknas" click.trigger="select(id)">${getMapName(id)}</button>\n    </div>\n    \n\n    <hr>\n\n    <map></map>\n</div>\n\n',x=M,A=[v];let N;function D(t){N||(N=i.b_N.define({name:y,template:M,dependencies:A})),t.register(N)}const j=JSON.parse('{"goultar":[134479872,134479874,134480896,134480898,134481920,134481922,134482944,134482946,134483968,134483970,134484992,134484994,170393600,170393602,170394624,170394626,170395648],"tournoi":[177471488,177471496,177472512,177472520,177473536,177473544,177474560,177474568,177475584,177475592,177476608,177476616,177477632,177478656,177478660,177479680,177479684,177480704,177481728,177603584,177603592],"duel":[177471490,177471494,177471498,177472514,177472518,177472522,177473538,177473542,177473546,177474562,177474566,177474570,177475586,177475590,177475594,177476610,177476618,177478658,177478662,177479686,177480706,177480710,177481730,177603586,177603590,177603594],"amakna":[177471492,177472512,177472516,177473536,177473540,177474560,177474564,177475584,177475588,177476608,177477632,177478660,177479684,177480708,177603584,177603588]}');var I=n(9344),T=n(2013);let C=class{constructor(t,e){this.db=t,this.ea=e,this.isLoaded=!1,this.mapIds=j,this.showGoultar=!0,this.showTournoi=!1,this.showDuel=!1,this.showAmakna=!1,this.showHelp=!1,this.db.isLoaded?this.onLoad():e.subscribe("db:loaded",(()=>this.onLoad()))}onLoad(){this.goultars=j.goultar.sort(((t,e)=>this.sortMaps(t,e))),this.tournois=j.tournoi.sort(((t,e)=>this.sortMaps(t,e))),this.duels=j.duel.sort(((t,e)=>this.sortMaps(t,e))),this.amaknas=j.amakna.sort(((t,e)=>this.sortMaps(t,e))),this.isLoaded=!0}sortMaps(t,e){let n=this.getMapName(t),s=this.getMapName(e);return this.toNumberAndRoman(n)-this.toNumberAndRoman(s)}toNumberAndRoman(t){return+t?+t:this.romanToArabic(t)}romanToArabic(t){const e={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};return[...t.toUpperCase()].reduce(((t,n,s,a)=>e[a[s+1]]>e[n]?t-e[n]:t+e[n]),0)}select(t){this.ea.publish("map:setid",t)}getMapName(t){try{if(this.db.hasI18n("map_"+t)){let e=this.db.getI18n("map_"+t).split(" ");return e[e.length-1]}return t+""}catch(e){return t+""}}clickGoultar(){this.showGoultar=!0,this.showTournoi=!1,this.showDuel=!1,this.showAmakna=!1,this.showHelp=!1}clickTournoi(){this.showGoultar=!1,this.showTournoi=!0,this.showDuel=!1,this.showAmakna=!1,this.showHelp=!1}clickDuel(){this.showGoultar=!1,this.showTournoi=!1,this.showDuel=!0,this.showAmakna=!1,this.showHelp=!1}clickAmakna(){this.showGoultar=!1,this.showTournoi=!1,this.showDuel=!1,this.showAmakna=!0,this.showHelp=!1}clickHelp(){this.showHelp=!this.showHelp}};C=(0,a.gn)([(0,i.MoW)(s),(0,a.fM)(1,I.Rp),(0,a.w6)("design:paramtypes",[T.db,Object])],C)}}]);