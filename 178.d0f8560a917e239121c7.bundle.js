"use strict";(self.webpackChunkencyclofus=self.webpackChunkencyclofus||[]).push([[178],{1221:(t,e,n)=>{n.d(e,{Z:()=>o});var s=n(8081),i=n.n(s),l=n(3645),r=n.n(l)()(i());r.push([t.id,"map {\n  width: 100%;\n}\nsvg {\n  width: 100%;\n  height: 100%;\n}\n.mapcontainer {\n  width: 1004.58946839px;\n  height: 820px;\n  margin-left: auto;\n  margin-right: auto;\n}\n.floor {\n  stroke: #a69e93;\n}\n.floor.k0 {\n  fill: #9d9588;\n}\n.floor.k1 {\n  fill: #988f82;\n}\n.floor:hover {\n  fill: #b87f49;\n}\n.hole {\n  fill: rgba(0, 0, 0, 0);\n}\n.block {\n  fill: rgba(59, 66, 68, 0.7);\n  stroke: #a69e93;\n}\n.object {\n  fill: rgba(126, 65, 65, 0.7);\n  stroke: #a69e93;\n}\n.blue {\n  fill: #0000ff;\n}\n.red {\n  fill: #ff0000;\n}\n.target {\n  fill: #ff00ff;\n}\n.highlight {\n  fill: rgba(92, 129, 70, 0.664);\n}\n.s1 {\n  fill: #ea00ff;\n}\n.s2 {\n  fill: #00ffb3;\n}\n.s3 {\n  fill: #e5ff00;\n}\n.loaderContainer {\n  width: 100%;\n}\n.loader {\n  margin-left: auto;\n  margin-right: auto;\n  margin-top: 50px;\n  border: 16px solid #f3f3f3;\n  /* Light grey */\n  border-top: 16px solid #3498db;\n  /* Blue */\n  border-radius: 50%;\n  width: 120px;\n  height: 120px;\n  -webkit-animation: spin 2s linear infinite;\n          animation: spin 2s linear infinite;\n}\n@-webkit-keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n",""]);const o=r},8178:(t,e,n)=>{n.r(e),n.d(e,{Map:()=>F});var s={};n.r(s),n.d(s,{default:()=>M,dependencies:()=>C,name:()=>k,register:()=>j,template:()=>w});var i=n(655),l=(n(1932),n(1542)),r=n(3379),o=n.n(r),a=n(7795),h=n.n(a),d=n(569),c=n.n(d),g=n(3565),p=n.n(g),f=n(9216),b=n.n(f),u=n(4589),m=n.n(u),y=n(1221),x={};x.styleTagTransform=m(),x.setAttributes=p(),x.insert=c().bind(null,"head"),x.domAPI=h(),x.insertStyleElement=b(),o()(y.Z,x),y.Z&&y.Z.locals&&y.Z.locals;const k="map",w='\x3c!-- name + reset --\x3e\n<div class="d-flex">\n    <b style="vertical-align: middle;">${mapName}</b>\n    <button class="btn btn-outline-dark ms-auto" click.trigger="resetObjects()">Reset</button>\n</div>\n\n\x3c!-- spinner --\x3e\n<div show.bind="!mapLoaded" class="loaderContainer">\n    <div class="loader"></div>\n</div>\n\n\x3c!-- map --\x3e\n<div show.bind="mapLoaded" class="mapcontainer">\n    <svg ref="svg">\n        <g ref="groupFloor" class=""></g>\n    </svg>\n</div>\n\n\x3c!-- init --\x3e\n${init()}\n',M=w,C=[];let v;function j(t){v||(v=l.b_N.define({name:k,template:w,dependencies:C})),t.register(v)}var I=n(9344);class N{}I.DI.createContainer().register(I.YM.singleton(N,N));class P{constructor(t,e){this.x=t,this.y=e}static zero(){return{x:0,y:0}}}class B{constructor(){this.cellHalf=.5,this.cells=[],this.objects=[],this.target=-1}getCaseCoordonnee(t){var e=Math.floor(t/27),n=(t-27*e)%14,s=P.zero();return s.y=e-n,s.x=(t-13*s.y)/14,s}dofus1CheckView(t,e){this.getCaseCoordonnee(t),this.getCaseCoordonnee(e),this.cells[t],this.cells[e]}getCaseNum(t,e){return 14*t+13*e}getPos(t){return{x:this.getX(t),y:this.getY(t)}}getPosOrtho(t){this.getPos(t)}getIdOrtho(t,e){}getPolarity(t){return this.getY(t)%2}getCellCoordById(t){var e=Math.floor(t/14),n=Math.floor((e+1)/2),s=t-14*e;return new P(n+s,s-(e-n))}getCellIdByCoord(t,e){return Math.floor(Number(14*(t-e)+e+(t-e)/2))}checkView(t,e){let n=this.getCellCoordById(t),s=this.getCellCoordById(e),i=s.y-n.y>=0?1:-1,l=s.x-n.x>=0?1:-1;if(n.x==s.x){for(let t=n.y;t*i<=s.y*i;t+=i){let e=n.x,s=t;if(!this.checkCellView(e,s))return!1}return!0}let r=(n.y-s.y)/(n.x-s.x),o=n.y-r*n.x,a=t=>r*t+o,h=s.x*l,d=n.x+this.cellHalf*l,c=n.y,g=n.y;for(;d*l<=h;){let t=a(d);t=i>0?Math.min(s.y,t):Math.max(s.y,t);let e=0,n=0;for(i>0?(e=Math.round(t),n=Math.ceil(t-this.cellHalf)):(e=Math.ceil(t-this.cellHalf),n=Math.round(t)),c=g;c*i<=n*i;){let t=d-this.cellHalf*l,e=c;if(!this.checkCellView(t,e))return!1;c+=i}g=e,d+=l}for(c=g;c*i<=s.y*i;){let t=d-this.cellHalf*l,e=c;if(!this.checkCellView(t,e))return!1;c+=i}{let t=d-this.cellHalf*l,e=c-i;if(!this.checkCellView(t,e))return!1}return!0}checkCellView(t,e){let n=this.getCellIdByCoord(t,e),s=this.cells[n];return!!s&&!!s.los&&!this.objects[n]}checkCellView1(t,e,n,s,i,l,r){var o=this.getCaseNum(t,e),a=this.cells[o];if(!a.los)return!1;if(this.objects[o])return!1;var h=Math.max(Math.abs(s.y-e),Math.abs(s.x-t)),d=h/r*l+s.z;let c=0==h||n||i.x==t&&i.y==e;var g=!this.objects[o]||!c;return!(!(a.los&&0<=d)||g)||n}getX(t){return t%14}getY(t){return(t-this.getX(t))/14}getId(t,e){return 14*e+t}getByXY(t,e){let n=this.getId(t,e);return this.cells[n]}}var L=n(624);const O=2*Math.sin(60*Math.PI/180)*40,V=2*Math.sin(30*Math.PI/180)*40,D=15;let F=class{constructor(t,e){this.ea=e,this.mapId="134479872",this.mapLoaded=!1,this.db=t,e.subscribe("db:loadmap",(t=>{if(this.initDone){let t=this.db.jsonMaps[this.mapId];this.board.cells=t.cells,this.generateMap()}else this.init()})),e.subscribe("db:loaded",(t=>{this.init()})),e.subscribe("map:setid",(t=>{if(this.mapId=t,this.db.jsonMaps[this.mapId]){let t=this.db.jsonMaps[this.mapId];this.board.cells=t.cells,this.generateMap()}else this.db.loadMap(this.mapId)}))}get mapName(){return this.db.getI18n("map_"+this.mapId)}init(){if(this.initDone)return"";if(!this.groupFloor)return"";if(!this.db.jsonMaps||!this.db.jsonMaps[this.mapId])return this.db.loadMap(this.mapId),"";this.groupFloor&&(this.groupFloor.innerHTML=""),this.board=new B;let t=this.db.jsonMaps[this.mapId];return this.board.cells=t.cells,this.generateMap(),this.initDone=!0,""}load(){}placeObject(t){this.board.objects[t]=!this.board.objects[t],JSON.stringify(this.board.getCellCoordById(t)),JSON.stringify(this.board.getPos(t)),this.generateMap()}placeTarget(t){console.log("placeTarget "+t),this.board.target==t?this.board.target=-1:this.board.target=t,this.generateMap()}resetObjects(){this.board.objects.length=0,this.generateMap()}generateMap(){for(let t=0;t<this.board.cells.length;t++){let e=this.board.cells[t],n=this.board.getX(t),s=this.board.getY(t),i=s%2,l={i:n,j:Math.floor(s/2),k:i},r="k"+i+" ";if(this.board.objects[t])r+="object ",this.getPolygonBlock(t,l,r);else if(e.los){let n=!1;-1!=this.board.target&&(n=this.board.checkView(this.board.target,t)),!e.mov&&e.los?r+="hole ":this.board.target==t?r+="target ":n?r+="highlight ":e.blue?r+="blue ":e.red?r+="red ":r+="floor ",this.getPolygon(t,l,r)}else r+="block ",this.getPolygonBlock(t,l,r)}this.mapLoaded=!0}getPolygon(t,e,n){let s=e.i*O,i=e.j*V,l=s+e.k*O/2,r=i+V/2+e.k*V/2,o=s+O/2+e.k*O/2,a=i+e.k*V/2,h=s+O+e.k*O/2,d=i+V/2+e.k*V/2,c=s+O/2+e.k*O/2,g=i+V+e.k*V/2,p=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t of n.split(" "))t&&p.classList.add(t);p.onclick=e=>{n.includes("hole")||this.placeTarget(t)},p.oncontextmenu=e=>{e.preventDefault(),n.includes("hole")||this.placeObject(t)};let f="";f+=l+","+r+" ",f+=o+","+a+" ",f+=h+","+d+" ",f+=c+","+g,p.setAttribute("points",f),this.initDone?this.groupFloor.children.item(t).replaceWith(p):this.groupFloor.appendChild(p)}getPolygonBlock(t,e,n){let s=e.i*O,i=e.j*V,l={x:s+e.k*O/2,y:i+V/2+e.k*V/2-D},r=s+O/2+e.k*O/2,o=i+e.k*V/2-D,a={x:s+O+e.k*O/2,y:i+V/2+e.k*V/2-D},h={x:s+O/2+e.k*O/2,y:i+V+e.k*V/2-D},d=l.x,c=l.y+D,g=h.x,p=h.y+D,f=a.x,b=a.y+D,u=document.createElementNS("http://www.w3.org/2000/svg","polygon"),m=document.createElementNS("http://www.w3.org/2000/svg","polygon"),y=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t of n.split(" "))t&&u.classList.add(t),t&&m.classList.add(t),t&&y.classList.add(t);let x=e=>{e.preventDefault(),n.includes("object")&&this.placeObject(t)};u.oncontextmenu=x,y.oncontextmenu=x,m.oncontextmenu=x;let k="";k+=l.x+","+l.y+" ",k+=r+","+o+" ",k+=a.x+","+a.y+" ",k+=h.x+","+h.y+" ",u.setAttribute("points",k),k=g+","+p+" ",k+=d+","+c+" ",k+=l.x+","+l.y+" ",k+=h.x+","+h.y+" ",m.setAttribute("points",k),k=g+","+p+" ",k+=f+","+b+" ",k+=a.x+","+a.y+" ",k+=h.x+","+h.y+" ",y.setAttribute("points",k);var w=document.createElementNS("http://www.w3.org/2000/svg","g");w.appendChild(u),w.appendChild(m),w.appendChild(y),this.initDone?this.groupFloor.childNodes.item(t).replaceWith(w):this.groupFloor.appendChild(w)}};F=(0,i.gn)([(0,l.MoW)(s),(0,I.f3)(L.db),(0,i.fM)(1,I.Rp),(0,i.w6)("design:paramtypes",[L.db,Object])],F)}}]);