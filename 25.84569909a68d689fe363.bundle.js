"use strict";(self.webpackChunkencyclofus=self.webpackChunkencyclofus||[]).push([[25,178],{1221:(t,e,n)=>{n.d(e,{Z:()=>a});var i=n(8081),s=n.n(i),o=n(3645),l=n.n(o)()(s());l.push([t.id,"map {\n  width: 100%;\n}\nsvg {\n  width: 100%;\n  height: 100%;\n}\n.mapcontainer {\n  width: 1004.58946839px;\n  height: 820px;\n  margin-left: auto;\n  margin-right: auto;\n}\n.floor {\n  stroke: #a69e93;\n}\n.floor.k0 {\n  fill: #9d9588;\n}\n.floor.k1 {\n  fill: #988f82;\n}\n.floor:hover {\n  fill: #b87f49;\n}\n.hole {\n  fill: rgba(0, 0, 0, 0);\n}\n.block {\n  fill: rgba(59, 66, 68, 0.7);\n  stroke: #a69e93;\n}\n.object {\n  fill: rgba(126, 65, 65, 0.7);\n  stroke: #a69e93;\n}\n.blue {\n  fill: #0000ff;\n}\n.red {\n  fill: #ff0000;\n}\n.target {\n  fill: #ff00ff;\n}\n.highlight {\n  fill: rgba(92, 129, 70, 0.664);\n}\n.s1 {\n  fill: #ea00ff;\n}\n.s2 {\n  fill: #00ffb3;\n}\n.s3 {\n  fill: #e5ff00;\n}\n.loaderContainer {\n  width: 100%;\n}\n.loader {\n  margin-left: auto;\n  margin-right: auto;\n  margin-top: 50px;\n  border: 16px solid #f3f3f3;\n  /* Light grey */\n  border-top: 16px solid #3498db;\n  /* Blue */\n  border-radius: 50%;\n  width: 120px;\n  height: 120px;\n  -webkit-animation: spin 2s linear infinite;\n          animation: spin 2s linear infinite;\n}\n@-webkit-keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n",""]);const a=l},3132:(t,e,n)=>{n.d(e,{Z:()=>a});var i=n(8081),s=n.n(i),o=n(3645),l=n.n(o)()(s());l.push([t.id,"maplist .btn {\n  border-width: 0 !important;\n  border-radius: 0 !important;\n}\nmaplist .radioDark:hover {\n  color: var(--bs-btn-hover-color);\n  background-color: var(--bs-btn-hover-bg);\n}\nmaplist text {\n  font: 13px noserif;\n  fill: black;\n}\n",""]);const a=l},8178:(t,e,n)=>{n.r(e),n.d(e,{Map:()=>O});var i={};n.r(i),n.d(i,{default:()=>v,dependencies:()=>M,name:()=>y,register:()=>I,template:()=>x});var s=n(655),o=(n(1932),n(1542)),l=n(3379),a=n.n(l),r=n(7795),d=n.n(r),h=n(569),c=n.n(h),p=n(3565),b=n.n(p),g=n(9216),u=n.n(g),f=n(4589),m=n.n(f),k=n(1221),w={};w.styleTagTransform=m(),w.setAttributes=b(),w.insert=c().bind(null,"head"),w.domAPI=d(),w.insertStyleElement=u(),a()(k.Z,w),k.Z&&k.Z.locals&&k.Z.locals;const y="map",x='\x3c!-- name + reset --\x3e\n<div class="d-flex">\n    <b style="vertical-align: middle;">${mapName}</b>\n    <button class="btn btn-outline-dark ms-auto" click.trigger="resetObjects()">Reset</button>\n</div>\n\n\x3c!-- spinner --\x3e\n<div show.bind="!mapLoaded" class="loaderContainer">\n    <div class="loader"></div>\n</div>\n\n\x3c!-- map --\x3e\n<div show.bind="mapLoaded" class="mapcontainer">\n    <svg ref="svg">\n        <g ref="groupFloor" class=""></g>\n    </svg>\n</div>\n\n\x3c!-- init --\x3e\n${init()}\n',v=x,M=[];let C;function I(t){C||(C=o.b_N.define({name:y,template:x,dependencies:M})),t.register(C)}var j=n(9344);class D{}j.DI.createContainer().register(j.YM.singleton(D,D));class N{constructor(t,e){this.x=t,this.y=e}static zero(){return{x:0,y:0}}}class H{constructor(){this.cellHalf=.5,this.cells=[],this.objects=[],this.target=-1}getCaseCoordonnee(t){var e=Math.floor(t/27),n=(t-27*e)%14,i=N.zero();return i.y=e-n,i.x=(t-13*i.y)/14,i}dofus1CheckView(t,e){this.getCaseCoordonnee(t),this.getCaseCoordonnee(e),this.cells[t],this.cells[e]}getCaseNum(t,e){return 14*t+13*e}getPos(t){return{x:this.getX(t),y:this.getY(t)}}getPosOrtho(t){this.getPos(t)}getIdOrtho(t,e){}getPolarity(t){return this.getY(t)%2}getCellCoordById(t){var e=Math.floor(t/14),n=Math.floor((e+1)/2),i=t-14*e;return new N(n+i,i-(e-n))}getCellIdByCoord(t,e){return Math.floor(Number(14*(t-e)+e+(t-e)/2))}checkView(t,e){let n=this.getCellCoordById(t),i=this.getCellCoordById(e),s=i.y-n.y>=0?1:-1,o=i.x-n.x>=0?1:-1;if(n.x==i.x){for(let t=n.y;t*s<=i.y*s;t+=s){let e=n.x,i=t;if(!this.checkCellView(e,i))return!1}return!0}let l=(n.y-i.y)/(n.x-i.x),a=n.y-l*n.x,r=t=>l*t+a,d=i.x*o,h=n.x+this.cellHalf*o,c=n.y,p=n.y;for(;h*o<=d;){let t=r(h);t=s>0?Math.min(i.y,t):Math.max(i.y,t);let e=0,n=0;for(s>0?(e=Math.round(t),n=Math.ceil(t-this.cellHalf)):(e=Math.ceil(t-this.cellHalf),n=Math.round(t)),c=p;c*s<=n*s;){let t=h-this.cellHalf*o,e=c;if(!this.checkCellView(t,e))return!1;c+=s}p=e,h+=o}for(c=p;c*s<=i.y*s;){let t=h-this.cellHalf*o,e=c;if(!this.checkCellView(t,e))return!1;c+=s}{let t=h-this.cellHalf*o,e=c-s;if(!this.checkCellView(t,e))return!1}return!0}checkCellView(t,e){let n=this.getCellIdByCoord(t,e),i=this.cells[n];return!!i&&!!i.los&&!this.objects[n]}checkCellView1(t,e,n,i,s,o,l){var a=this.getCaseNum(t,e),r=this.cells[a];if(!r.los)return!1;if(this.objects[a])return!1;var d=Math.max(Math.abs(i.y-e),Math.abs(i.x-t)),h=d/l*o+i.z;let c=0==d||n||s.x==t&&s.y==e;var p=!this.objects[a]||!c;return!(!(r.los&&0<=h)||p)||n}getX(t){return t%14}getY(t){return(t-this.getX(t))/14}getId(t,e){return 14*e+t}getByXY(t,e){let n=this.getId(t,e);return this.cells[n]}}var T=n(624);const B=2*Math.sin(60*Math.PI/180)*40,P=2*Math.sin(30*Math.PI/180)*40,L=15;let O=class{constructor(t,e){this.ea=e,this.mapId="134479872",this.mapLoaded=!1,this.db=t,e.subscribe("db:loadmap",(t=>{if(this.initDone){let t=this.db.jsonMaps[this.mapId];this.board.cells=t.cells,this.generateMap()}else this.init()})),e.subscribe("db:loaded",(t=>{this.init()})),e.subscribe("map:setid",(t=>{if(this.mapId=t,this.db.jsonMaps[this.mapId]){let t=this.db.jsonMaps[this.mapId];this.board.cells=t.cells,this.generateMap()}else this.db.loadMap(this.mapId)}))}get mapName(){return this.db.getI18n("map_"+this.mapId)}init(){if(this.initDone)return"";if(!this.groupFloor)return"";if(!this.db.jsonMaps||!this.db.jsonMaps[this.mapId])return this.db.loadMap(this.mapId),"";this.groupFloor&&(this.groupFloor.innerHTML=""),this.board=new H;let t=this.db.jsonMaps[this.mapId];return this.board.cells=t.cells,this.generateMap(),this.initDone=!0,""}load(){}placeObject(t){this.board.objects[t]=!this.board.objects[t],JSON.stringify(this.board.getCellCoordById(t)),JSON.stringify(this.board.getPos(t)),this.generateMap()}placeTarget(t){console.log("placeTarget "+t),this.board.target==t?this.board.target=-1:this.board.target=t,this.generateMap()}resetObjects(){this.board.objects.length=0,this.generateMap()}generateMap(){for(let t=0;t<this.board.cells.length;t++){let e=this.board.cells[t],n=this.board.getX(t),i=this.board.getY(t),s=i%2,o={i:n,j:Math.floor(i/2),k:s},l="k"+s+" ";if(this.board.objects[t])l+="object ",this.getPolygonBlock(t,o,l);else if(e.los){let n=!1;-1!=this.board.target&&(n=this.board.checkView(this.board.target,t)),!e.mov&&e.los?l+="hole ":this.board.target==t?l+="target ":n?l+="highlight ":e.blue?l+="blue ":e.red?l+="red ":l+="floor ",this.getPolygon(t,o,l)}else l+="block ",this.getPolygonBlock(t,o,l)}this.mapLoaded=!0}getPolygon(t,e,n){let i=e.i*B,s=e.j*P,o=i+e.k*B/2,l=s+P/2+e.k*P/2,a=i+B/2+e.k*B/2,r=s+e.k*P/2,d=i+B+e.k*B/2,h=s+P/2+e.k*P/2,c=i+B/2+e.k*B/2,p=s+P+e.k*P/2,b=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t of n.split(" "))t&&b.classList.add(t);b.onclick=e=>{n.includes("hole")||this.placeTarget(t)},b.oncontextmenu=e=>{e.preventDefault(),n.includes("hole")||this.placeObject(t)};let g="";g+=o+","+l+" ",g+=a+","+r+" ",g+=d+","+h+" ",g+=c+","+p,b.setAttribute("points",g);var u=document.createElementNS("http://www.w3.org/2000/svg","g");if(u.appendChild(b),-1!=this.board.target&&n.includes("highlight")){let e=this.board.getCellCoordById(t),n=this.board.getCellCoordById(this.board.target),i=Math.abs(e.x-n.x)+Math.abs(e.y-n.y),s=document.createElementNS("http://www.w3.org/2000/svg","text");s.textContent=i+"";let o=i>=10?7:3;s.setAttribute("x",a-o+""),s.setAttribute("y",r+20+3+""),u.appendChild(s)}this.initDone?this.groupFloor.children.item(t).replaceWith(u):this.groupFloor.appendChild(u)}getPolygonBlock(t,e,n){let i=e.i*B,s=e.j*P,o={x:i+e.k*B/2,y:s+P/2+e.k*P/2-L},l=i+B/2+e.k*B/2,a=s+e.k*P/2-L,r={x:i+B+e.k*B/2,y:s+P/2+e.k*P/2-L},d={x:i+B/2+e.k*B/2,y:s+P+e.k*P/2-L},h=o.x,c=o.y+L,p=d.x,b=d.y+L,g=r.x,u=r.y+L,f=document.createElementNS("http://www.w3.org/2000/svg","polygon"),m=document.createElementNS("http://www.w3.org/2000/svg","polygon"),k=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t of n.split(" "))t&&f.classList.add(t),t&&m.classList.add(t),t&&k.classList.add(t);let w=e=>{e.preventDefault(),n.includes("object")&&this.placeObject(t)};f.oncontextmenu=w,k.oncontextmenu=w,m.oncontextmenu=w;let y="";y+=o.x+","+o.y+" ",y+=l+","+a+" ",y+=r.x+","+r.y+" ",y+=d.x+","+d.y+" ",f.setAttribute("points",y),y=p+","+b+" ",y+=h+","+c+" ",y+=o.x+","+o.y+" ",y+=d.x+","+d.y+" ",m.setAttribute("points",y),y=p+","+b+" ",y+=g+","+u+" ",y+=r.x+","+r.y+" ",y+=d.x+","+d.y+" ",k.setAttribute("points",y);var x=document.createElementNS("http://www.w3.org/2000/svg","g");x.appendChild(f),x.appendChild(m),x.appendChild(k),this.initDone?this.groupFloor.childNodes.item(t).replaceWith(x):this.groupFloor.appendChild(x)}};O=(0,s.gn)([(0,o.MoW)(i),(0,j.f3)(T.db),(0,s.fM)(1,j.Rp),(0,s.w6)("design:paramtypes",[T.db,Object])],O)},1025:(t,e,n)=>{n.r(e),n.d(e,{MapList:()=>T});var i={};n.r(i),n.d(i,{default:()=>M,dependencies:()=>C,name:()=>x,register:()=>j,template:()=>v});var s=n(655),o=(n(1932),n(1542)),l=n(3379),a=n.n(l),r=n(7795),d=n.n(r),h=n(569),c=n.n(h),p=n(3565),b=n.n(p),g=n(9216),u=n.n(g),f=n(4589),m=n.n(f),k=n(3132),w={};w.styleTagTransform=m(),w.setAttributes=b(),w.insert=c().bind(null,"head"),w.domAPI=d(),w.insertStyleElement=u(),a()(k.Z,w),k.Z&&k.Z.locals&&k.Z.locals;var y=n(8178);const x="maplist",v='\n\n<div if.bind="db.isLoaded">\n    <div class="btn-group" style="" role="group" aria-label="Basic radio toggle button group">\n        <input type="radio" class="btn-check" name="btnradioa" id="btnGoultar" autocomplete="off" checked click.delegate="clickGoultar()">\n        <label class="btn btn-outline-dark radioDark" for="btnGoultar" t="maps.goultar"></label>\n\n        <input type="radio" class="btn-check" name="btnradioa" id="btnTournoi" autocomplete="off" click.delegate="clickTournoi()">\n        <label class="btn btn-outline-dark radioDark" for="btnTournoi" t="maps.tournament"></label>\n\n        <input type="radio" class="btn-check" name="btnradioa" id="btnDuel" autocomplete="off" click.delegate="clickDuel()">\n        <label class="btn btn-outline-dark radioDark" for="btnDuel" t="maps.duel"></label>\n\n        <input type="radio" class="btn-check" name="btnradioa" id="btnHelp" autocomplete="off" click.delegate="clickHelp()">\n        <label class="btn btn-outline-dark radioDark ms-auto" style="" for="btnHelp" t="help"></label>\n    </div>\n\n    <div show.bind="showHelp">\n        <span style="padding-left: 12px;" t="maps.clickl"></span> \n        <br/>  \n        <span style="padding-left: 12px;" t="maps.clickr"></span>\n    </div>\n\n    <hr>\n\n    <div show.bind="showGoultar">\n        \x3c!-- <input repeat.for="id of goultars" type="radio" class="btn-check" name="btnradio${id}" id="btn${id}" autocomplete="off" click.delegate="select(id)">\n        <label repeat.for="id of goultars" class="btn btn-outline-dark radioDark" for="btn${id}">${getMapName(id)}</label> --\x3e\n        <button class="btn btn-outline-dark" repeat.for="id of goultars" click.trigger="select(id)">${getMapName(id)}</button>\n    </div>\n\n    <div show.bind="showTournoi">\n        <button class="btn btn-outline-dark" repeat.for="id of tournois" click.trigger="select(id)">${getMapName(id)}</button>\n    </div>\n\n    <div show.bind="showDuel">\n        <button class="btn btn-outline-dark" repeat.for="id of mapIds.duel" click.trigger="select(id)">${getMapName(id)}</button>\n    </div>\n    \n\n    <hr>\n\n    <map></map>\n</div>\n\n',M=v,C=[y];let I;function j(t){I||(I=o.b_N.define({name:x,template:v,dependencies:C})),t.register(I)}const D=JSON.parse('{"goultar":[134479872,134479874,134480896,134480898,134481920,134481922,134482944,134482946,134483968,134483970,134484992,134484994,170393600,170393602,170394624,170394626,170395648],"tournoi":[177471488,177471496,177472512,177472520,177473536,177473544,177474560,177474568,177475584,177475592,177476608,177476616,177477632,177478656,177478660,177479680,177479684,177480704,177481728,177603584,177603592],"duel":[177471490,177471498,177472514,177472522,177473538,177473546,177474562,177474570,177475586,177475594,177476610,177476618,177478658,177478662,177479686,177480706,177481730,177603586,177603594]}');var N=n(9344),H=n(624);let T=class{constructor(t,e){this.ea=e,this.mapIds=D,this.goultars=D.goultar.sort(),this.tournois=D.tournoi.sort(),this.duels=D.duel.sort(),this.showGoultar=!0,this.showTournoi=!1,this.showDuel=!1,this.showHelp=!1,this.db=t}select(t){this.ea.publish("map:setid",t)}getMapName(t){let e=this.db.getI18n("map_"+t).split(" ");return e[e.length-1]}clickGoultar(){this.showGoultar=!0,this.showTournoi=!1,this.showDuel=!1,this.showHelp=!1}clickTournoi(){this.showGoultar=!1,this.showTournoi=!0,this.showDuel=!1,this.showHelp=!1}clickDuel(){this.showGoultar=!1,this.showTournoi=!1,this.showDuel=!0,this.showHelp=!1}clickHelp(){this.showHelp=!this.showHelp}};T=(0,s.gn)([(0,o.MoW)(i),(0,N.f3)(H.db),(0,s.fM)(1,N.Rp),(0,s.w6)("design:paramtypes",[H.db,Object])],T)}}]);