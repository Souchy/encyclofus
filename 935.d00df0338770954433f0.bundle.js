"use strict";(self.webpackChunkencyclofus=self.webpackChunkencyclofus||[]).push([[935,898],{1221:(t,e,n)=>{n.d(e,{Z:()=>o});var i=n(8081),a=n.n(i),s=n(3645),l=n.n(s)()(a());l.push([t.id,"map {\n  width: 100%;\n}\nsvg {\n  width: 100%;\n  height: 100%;\n}\nmap text {\n  font: 13px noserif;\n  fill: var(--bs-body-color);\n  pointer-events: none;\n}\n.mapcontainer {\n  width: 1004.58946839px;\n  height: 820px;\n  margin-left: auto;\n  margin-right: auto;\n}\n.floor {\n  stroke: #a69e93;\n}\n.floor.k0 {\n  fill: #9d9588;\n}\n.floor.k1 {\n  fill: #91897e;\n}\n.floor:hover {\n  fill: #b87f49;\n}\n.hole {\n  fill: rgba(0, 0, 0, 0);\n}\n.block {\n  fill: rgba(59, 66, 68, 0.7);\n  stroke: #a69e93;\n}\n.object {\n  fill: rgba(126, 65, 65, 0.7);\n  stroke: #a69e93;\n}\n.blue {\n  fill: #0000ff;\n}\n.red {\n  fill: #ff0000;\n}\n.target {\n  fill: #ff00ff;\n}\n.highlight {\n  fill: rgba(92, 129, 70, 0.664);\n}\n.s1 {\n  fill: #ea00ff;\n}\n.s2 {\n  fill: #00ffb3;\n}\n.s3 {\n  fill: #e5ff00;\n}\n",""]);const o=l},3132:(t,e,n)=>{n.d(e,{Z:()=>o});var i=n(8081),a=n.n(i),s=n(3645),l=n.n(s)()(a());l.push([t.id,"maplist .btn {\n  border-width: 0 !important;\n  border-radius: 0 !important;\n}\nmaplist .maplist {\n  height: 144px;\n  max-height: 144px;\n  overflow-y: auto;\n}\nmaplist .maplist button {\n  min-width: 175px;\n  text-align: left;\n}\n",""]);const o=l},1898:(t,e,n)=>{n.r(e),n.d(e,{Map:()=>S});var i={};n.r(i),n.d(i,{default:()=>x,dependencies:()=>M,name:()=>w,register:()=>j,template:()=>y});var a=n(655),s=(n(1932),n(1542)),l=n(3379),o=n.n(l),r=n(7795),d=n.n(r),p=n(569),h=n.n(p),c=n(3565),b=n.n(c),g=n(9216),u=n.n(g),m=n(4589),f=n.n(m),v=n(1221),k={};k.styleTagTransform=f(),k.setAttributes=b(),k.insert=h().bind(null,"head"),k.domAPI=d(),k.insertStyleElement=u(),o()(v.Z,k),v.Z&&v.Z.locals&&v.Z.locals;const w="map",y='\x3c!-- name + reset --\x3e\n<div class="d-flex">\n    <b style="vertical-align: middle;">${mapName}</b>\n    <button class="btn btn-outline-dark ms-auto" click.trigger="resetObjects()">Reset</button>\n</div>\n\n\x3c!-- spinner --\x3e\n<div show.bind="!mapLoaded" class="loaderContainer">\n    <div class="loader"></div>\n</div>\n\n\x3c!-- map --\x3e\n<div show.bind="mapLoaded" class="mapcontainer">\n    <svg ref="svg">\n        <g ref="groupFloor" class=""></g>\n    </svg>\n</div>\n\n\x3c!-- init --\x3e\n${init()}\n',x=y,M=[];let N;function j(t){N||(N=s.b_N.define({name:w,template:y,dependencies:M})),t.register(N)}var I=n(9344),C=n(3443),D=n(2013),L=n(1574);const A=2*Math.sin(60*Math.PI/180)*40,G=2*Math.sin(30*Math.PI/180)*40,$=15;let S=class{constructor(t,e){this.db=t,this.ea=e,this.mapId=String(L.goultar3v3[0]),this.mapLoaded=!1,e.subscribe("db:loadmap",(t=>{if(this.initDone){let t=this.db.jsonMaps[this.mapId];this.board.cells=t.cells,this.generateMap()}else this.init()})),e.subscribe("db:loaded",(t=>{this.init()})),e.subscribe("map:setid",(t=>{if(this.mapId=t,this.db.jsonMaps[this.mapId]){let t=this.db.jsonMaps[this.mapId];this.board.cells=t.cells,this.generateMap()}else this.db.loadMap(this.mapId)}))}get mapName(){return this.db.getI18n("map_"+this.mapId)}init(){if(this.initDone)return"";if(!this.groupFloor)return"";if(!this.db.jsonMaps||!this.db.jsonMaps[this.mapId])return this.db.loadMap(this.mapId),"";console.log("map init "+this.mapId),this.groupFloor&&(this.groupFloor.innerHTML=""),this.board=new C.$l;let t=this.db.jsonMaps[this.mapId];return this.board.cells=t.cells,this.generateMap(),this.initDone=!0,""}load(){}placeObject(t){this.board.objects[t]=!this.board.objects[t],JSON.stringify(this.board.getCellCoordById(t)),JSON.stringify(this.board.getPos(t)),this.generateMap()}placeTarget(t){console.log("placeTarget "+t),this.board.target==t?this.board.target=-1:this.board.target=t,this.generateMap()}resetObjects(){this.board.objects.length=0,this.generateMap()}generateMap(){let t=this.board.getViews(this.board.target);for(let e=0;e<this.board.cells.length;e++){let n=this.board.cells[e],i=this.board.getX(e),a=this.board.getY(e),s=a%2,l={i,j:Math.floor(a/2),k:s},o="k"+s+" ";if(this.board.objects[e])o+="object ",this.getPolygonBlock(e,l,o);else if(n.los){let i=!1;-1!=this.board.target&&(i=t.includes(e)),!n.mov&&n.los?o+="hole ":this.board.target==e?o+="target ":i?o+="highlight ":n.blue?o+="blue ":n.red?o+="red ":o+="floor ",this.getPolygon(e,l,o)}else o+="block ",this.getPolygonBlock(e,l,o)}this.mapLoaded=!0}getPolygon(t,e,n){let i=e.i*A,a=e.j*G,s=i+e.k*A/2,l=a+G/2+e.k*G/2,o=i+A/2+e.k*A/2,r=a+e.k*G/2,d=i+A+e.k*A/2,p=a+G/2+e.k*G/2,h=i+A/2+e.k*A/2,c=a+G+e.k*G/2,b=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t of n.split(" "))t&&b.classList.add(t);b.onclick=e=>{n.includes("hole")||this.placeTarget(t)},b.oncontextmenu=e=>{e.preventDefault(),n.includes("hole")||this.placeObject(t)};let g="";g+=s+","+l+" ",g+=o+","+r+" ",g+=d+","+p+" ",g+=h+","+c,b.setAttribute("points",g);var u=document.createElementNS("http://www.w3.org/2000/svg","g");if(u.appendChild(b),-1!=this.board.target&&n.includes("highlight")){let e=this.board.getCellCoordById(t),n=this.board.getCellCoordById(this.board.target),i=Math.abs(e.x-n.x)+Math.abs(e.y-n.y),a=document.createElementNS("http://www.w3.org/2000/svg","text");a.textContent=i+"";let s=i>=10?7:3;a.setAttribute("x",o-s+""),a.setAttribute("y",r+20+3+""),u.appendChild(a)}this.initDone?this.groupFloor.children.item(t).replaceWith(u):this.groupFloor.appendChild(u)}getPolygonBlock(t,e,n){let i=e.i*A,a=e.j*G,s={x:i+e.k*A/2,y:a+G/2+e.k*G/2-$},l=i+A/2+e.k*A/2,o=a+e.k*G/2-$,r={x:i+A+e.k*A/2,y:a+G/2+e.k*G/2-$},d={x:i+A/2+e.k*A/2,y:a+G+e.k*G/2-$},p=s.x,h=s.y+$,c=d.x,b=d.y+$,g=r.x,u=r.y+$,m=document.createElementNS("http://www.w3.org/2000/svg","polygon"),f=document.createElementNS("http://www.w3.org/2000/svg","polygon"),v=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t of n.split(" "))t&&m.classList.add(t),t&&f.classList.add(t),t&&v.classList.add(t);let k=e=>{e.preventDefault(),n.includes("object")&&this.placeObject(t)};m.oncontextmenu=k,v.oncontextmenu=k,f.oncontextmenu=k;let w="";w+=s.x+","+s.y+" ",w+=l+","+o+" ",w+=r.x+","+r.y+" ",w+=d.x+","+d.y+" ",m.setAttribute("points",w),w=c+","+b+" ",w+=p+","+h+" ",w+=s.x+","+s.y+" ",w+=d.x+","+d.y+" ",f.setAttribute("points",w),w=c+","+b+" ",w+=g+","+u+" ",w+=r.x+","+r.y+" ",w+=d.x+","+d.y+" ",v.setAttribute("points",w);var y=document.createElementNS("http://www.w3.org/2000/svg","g");y.appendChild(m),y.appendChild(f),y.appendChild(v),this.initDone?this.groupFloor.childNodes.item(t).replaceWith(y):this.groupFloor.appendChild(y)}};S=(0,a.gn)([(0,s.MoW)(i),(0,I.f3)(D.db,I.Rp),(0,a.w6)("design:paramtypes",[D.db,Object])],S)},3935:(t,e,n)=>{n.r(e),n.d(e,{MapList:()=>A});var i={};n.r(i),n.d(i,{default:()=>M,dependencies:()=>N,name:()=>y,register:()=>I,template:()=>x});var a=n(655),s=(n(1932),n(1542)),l=n(3379),o=n.n(l),r=n(7795),d=n.n(r),p=n(569),h=n.n(p),c=n(3565),b=n.n(c),g=n(9216),u=n.n(g),m=n(4589),f=n.n(m),v=n(3132),k={};k.styleTagTransform=f(),k.setAttributes=b(),k.insert=h().bind(null,"head"),k.domAPI=d(),k.insertStyleElement=u(),o()(v.Z,k),v.Z&&v.Z.locals&&v.Z.locals;var w=n(1898);const y="maplist",x='\n\n<div if.bind="isLoaded">\n    <div class="btn-group" style="" role="group" aria-label="Basic radio toggle button group">\n        <input type="radio" class="btn-check" name="btnradioa" id="btnGoultar3v3" autocomplete="off" click.delegate="clickGoultar3v3()" checked>\n        <label class="btn btn-outline-dark radioDark" for="btnGoultar3v3" t="maps.goultar3v3"></label>\n        \n        <input type="radio" class="btn-check" name="btnradioa" id="btnGoultar1v1" autocomplete="off" click.delegate="clickGoultar1v1()">\n        <label class="btn btn-outline-dark radioDark" for="btnGoultar1v1" t="maps.goultar1v1"></label>\n\n        <input type="radio" class="btn-check" name="btnradioa" id="btnTournoi" autocomplete="off" click.delegate="clickKoli3v3()">\n        <label class="btn btn-outline-dark radioDark" for="btnTournoi" t="maps.koli3v3"></label>\n\n        <input type="radio" class="btn-check" name="btnradioa" id="btnDuel" autocomplete="off" click.delegate="clickKoli1v1()">\n        <label class="btn btn-outline-dark radioDark" for="btnDuel" t="maps.koli1v1"></label>\n\n        <input type="radio" class="btn-check" name="btnradioa" id="btnHelp" autocomplete="off" click.delegate="clickHelp()">\n        <label class="btn btn-outline-dark radioDark" style="margin-left: auto;" for="btnHelp" t="help"></label>\n    </div>\n\n    <div show.bind="showHelp">\n        <span style="padding-left: 12px;" t="maps.clickl"></span> \n        <br/>  \n        <span style="padding-left: 12px;" t="maps.clickr"></span>\n        <br/>  \n        <span style="padding-left: 12px;" t="maps.mapid"></span>\n    </div>\n\n    <hr>\n\n    <div show.bind="showGoultar3v3" class="maplist">\n        <template repeat.for="id of goultars3v3">\n            <input type="radio" class="btn-check" name="goultar3v3" id="${id}" autocomplete="off" click.delegate="select(id)">\n            <label class="btn btn-outline-dark radioDark" style="margin-left: auto;" for="${id}">${getMapName(id)}</label>\n        </template>\n    </div>\n    \n    <div show.bind="showGoultar1v1" class="maplist">\n        <template repeat.for="id of goultars1v1">\n            <input type="radio" class="btn-check" name="goultar1v1" id="${id}" autocomplete="off" click.delegate="select(id)">\n            <label class="btn btn-outline-dark radioDark" style="margin-left: auto;" for="${id}">${getMapName(id)}</label>\n        </template>\n    </div>\n\n    <div show.bind="showKoli3v3" class="maplist">\n        <template repeat.for="id of koli3v3s">\n            <input type="radio" class="btn-check" name="koli3v3" id="${id}" autocomplete="off" click.delegate="select(id)">\n            <label class="btn btn-outline-dark radioDark" style="margin-left: auto;" for="${id}">${getMapName(id)}</label>\n        </template>\n    </div>\n\n    <div show.bind="showKoli1v1" class="maplist">\n        <template repeat.for="id of koli1v1s">\n            <input type="radio" class="btn-check" name="koli1v1" id="${id}" autocomplete="off" click.delegate="select(id)">\n            <label class="btn btn-outline-dark radioDark" style="margin-left: auto;" for="${id}">${getMapName(id)}</label>\n        </template>\n    </div>\n\n    <hr>\n\n    <map></map>\n</div>\n\n',M=x,N=[w];let j;function I(t){j||(j=s.b_N.define({name:y,template:x,dependencies:N})),t.register(j)}var C=n(1574),D=n(9344),L=n(2013);let A=class{constructor(t,e){this.db=t,this.ea=e,this.isLoaded=!1,this.mapIds=C,this.showGoultar3v3=!0,this.showGoultar1v1=!1,this.showKoli3v3=!1,this.showKoli1v1=!1,this.showHelp=!1,this.db.isLoaded?this.onLoad():e.subscribe("db:loaded",(()=>this.onLoad()))}onLoad(){this.goultars3v3=C.goultar3v3.sort(((t,e)=>this.sortMaps(t,e))),this.goultars1v1=C.goultar1v1.sort(((t,e)=>this.sortMaps(t,e))),this.koli3v3s=C.koli3v3.sort(((t,e)=>this.sortMaps(t,e))),this.koli1v1s=C.koli1v1.sort(((t,e)=>this.sortMaps(t,e))),this.isLoaded=!0}sortMaps(t,e){let n=this.getMapName(t),i=this.getMapName(e);return(this.getMapNumber(n)||this.toNumberAndRoman(n.split(" ").pop()))-(this.getMapNumber(i)||this.toNumberAndRoman(i.split(" ").pop()))}getMapNumber(t){return+t.substring(1).split(" ")[0]}toNumberAndRoman(t){return+t?+t:this.romanToArabic(t)}romanToArabic(t){const e={I:1,V:5,X:10,L:50,C:100,D:500,M:1e3};return[...t.toUpperCase()].reduce(((t,n,i,a)=>e[a[i+1]]>e[n]?t-e[n]:t+e[n]),0)}select(t){this.ea.publish("map:setid",t)}getMapName(t){try{if(this.db.hasI18n("map_"+t)){return this.db.getI18n("map_"+t)}return"Amakna "+t}catch(e){return t+""}}hide(){this.showGoultar3v3=!1,this.showGoultar1v1=!1,this.showKoli3v3=!1,this.showKoli1v1=!1,this.showHelp=!1}clickGoultar3v3(){this.hide(),this.showGoultar3v3=!0}clickGoultar1v1(){this.hide(),this.showGoultar1v1=!0}clickKoli3v3(){this.hide(),this.showKoli3v3=!0}clickKoli1v1(){this.hide(),this.showKoli1v1=!0}clickHelp(){this.showHelp=!this.showHelp}};A=(0,a.gn)([(0,s.MoW)(i),(0,D.f3)(L.db,D.Rp),(0,a.w6)("design:paramtypes",[L.db,Object])],A)},1574:t=>{t.exports=JSON.parse('{"goultar3v3":[134480896,134481920,134482944,134482946,134483968,134483970,134484994,170393602,170394624,170394626,230162945,230162949,230162953,230162957,230163969,230163973,230163977,230163981,230164993,230164997,230165001,230165005,230166017,230166021,230166025,230166029,230167041,230167045,230167049,230168065,230168069,230168073,230169089,230169093,230169097,230170113,230170121,230171137,230171141,230171145,230172161,230172165,230172169,230173185,230173189,230173193,230174209,230174213,230174217,230175237],"goultar1v1":[230162947,230162951,230162955,230162959,230163971,230163975,230163979,230163983,230164995,230164999,230165003,230165007,230166019,230166023,230166027,230166031,230167043,230167047,230167051,230168067,230168071,230168075,230169091,230169095,230169099,230170115,230170123,230171139,230171143,230171147,230172163,230172167,230172171,230173187,230173191,230173195,230174211,230174215,230174219,230175239],"koli3v3":[177471488,177471492,177471496,177471500,177472512,177472516,177472520,177472524,177473536,177473540,177473544,177473548,177474560,177474564,177474568,177475584,177475588,177475592,177476608,177476616,177477632,177477640,177478656,177478660,177478664,177479680,177479684,177480704,177480708,177481728,177481732,177482756,177603584,177603588,177603592,177603596],"koli1v1":[177471490,177471494,177471498,177471502,177472514,177472518,177472522,177472526,177473538,177473542,177473546,177473550,177474562,177474566,177474570,177475586,177475590,177475594,177476610,177476618,177477642,177478658,177478662,177478666,177479686,177480706,177480710,177481730,177481734,177482758,177603586,177603590,177603594,177603598]}')}}]);