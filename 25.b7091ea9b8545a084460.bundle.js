"use strict";(self.webpackChunkencyclofus=self.webpackChunkencyclofus||[]).push([[25],{3720:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(8081),s=n.n(i),a=n(3645),o=n.n(a)()(s());o.push([e.id,"itemsheet {\n  --sheetaccent: var(--accent1);\n  --sheetaccenthover: var(--accent0);\n  width: 250px;\n  min-height: 150px;\n  display: block;\n  cursor: pointer;\n  margin: 5px;\n  padding: 5px;\n  background-color: var(--bs-body-bg);\n  border: 1px solid transparent;\n}\nitemsheet .itemIcon {\n  width: 40px;\n  height: 40px;\n  margin-right: 10px;\n}\nitemsheet table {\n  --bs-table-striped-bg: rgba(0, 0, 0, 0) !important;\n}\nitemsheet .title {\n  color: var(--sheetaccent);\n  font-size: 1.1rem;\n}\nitemsheet .weaponConditions {\n  padding-left: 2px;\n  opacity: 0.75;\n}\nitemsheet .weaponEffects {\n  display: block;\n  opacity: 0.75;\n}\nitemsheet .conditions {\n  border-top: 1px dashed var(--sheetaccent);\n  opacity: 0.5;\n}\nitemsheet .btn.btn-compare {\n  right: 5px;\n  position: absolute;\n  margin-left: auto;\n  width: 24px;\n  height: 24px;\n  color: var(--bs-body-color);\n  background-color: var(--bs-body-bg);\n  z-index: 3;\n  padding: 0px !important;\n}\nitemsheet .btn.btn-compare i {\n  font-size: 0.7rem;\n}\nitemsheet .btn.btn-compare:hover {\n  color: var(--bs-body-bg);\n  background-color: var(--bs-body-color);\n}\nitemsheet.hiddensheet {\n  display: none;\n}\nitemsheet:hover {\n  border-color: var(--sheetaccenthover);\n  z-index: 5;\n}\nitemsheet:hover .title {\n  color: var(--sheetaccenthover);\n}\nitemsheet:hover .conditions {\n  border-color: var(--sheetaccenthover);\n}\nitemsheet:hover .weaponEffects {\n  border-color: var(--sheetaccenthover);\n}\n",""]);const r=o},6491:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(8081),s=n.n(i),a=n(3645),o=n.n(a)()(s());o.push([e.id,'.searchable {\n  width: 100%;\n  float: left;\n}\n.searchable input {\n  width: 100%;\n  /* Safari/Chrome, other WebKit */\n  /* Firefox, other Gecko */\n  box-sizing: border-box;\n  /* Opera/IE 8+ */\n  display: block;\n  background-clip: padding-box;\n  border: 1px solid var(--accent1);\n  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n}\n.searchable dl {\n  width: 90%;\n  position: absolute;\n  display: none;\n  list-style-type: none;\n  border: 1px solid var(--accent1);\n  border-top: none;\n  max-height: 380px;\n  margin: 0;\n  overflow-y: scroll;\n  overflow-x: hidden;\n  padding: 0;\n  background-color: var(--bg0);\n  z-index: 3;\n}\n.searchable dl dt {\n  height: 25px;\n  color: var(--front0);\n  background-color: var(--bg1);\n  z-index: 4;\n}\n.searchable dl dd {\n  height: 25px;\n  cursor: pointer;\n  color: var(--front0);\n  background-color: var(--bg0);\n  z-index: 4;\n  margin: 0px;\n}\n.searchable dl dd.selected {\n  background-color: #e8e8e8;\n  color: #333;\n}\nsetfilter {\n  padding-top: 0.5rem;\n  padding-left: 10%;\n  padding-right: 10%;\n  display: block;\n}\nsetfilter > div {\n  /* width: 1200px; */\n  /* height: 300px; */\n  /* background: white; */\n  /* border: 1px solid var(--accent1); */\n}\n/* Search bar */\nsetfilter .search {\n  width: 100%;\n  height: 40px;\n  padding-left: 5px;\n}\n/* Toggle button */\nsetfilter .toggle {\n  border: 1px solid var(--accent1);\n  background: transparent;\n  margin-bottom: 4px;\n  margin-right: 4px;\n  padding: 2px;\n  cursor: pointer;\n  text-align: center;\n  min-width: 50px;\n  height: 35px;\n}\nsetfilter .toggle label {\n  cursor: pointer;\n  margin: 0px;\n}\n/* Checkbox input */\nsetfilter input[type="checkbox"] {\n  appearance: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n}\nsetfilter .checkbox {\n  width: 15px;\n  height: 15px;\n  background: var(--bg0);\n  border: 1px solid var(--accent1);\n  padding: 2px;\n}\nsetfilter .checkbox:checked {\n  background: var(--accent1);\n}\n/* title labels */\nsetfilter .title {\n  font-size: 25px;\n  font-weight: bold;\n  /* margin-left: 5px; */\n}\n/* block list */\nsetfilter .blocklist .block {\n  margin-bottom: 10px;\n}\nsetfilter .blocklist .block .blocktitle {\n  font-size: 20px;\n  color: var(--front0);\n  background: var(--bg0);\n  border-color: var(--bg0);\n  width: 100%;\n  /* margin-left: 5px; */\n  /* font-weight: bold; */\n}\nsetfilter .blocklist .block .blocktitle:focus {\n  border-color: var(--bg0) !important;\n}\nsetfilter .blocklist .block .mod {\n  margin-bottom: 10px;\n  position: relative;\n}\nsetfilter .btnAdd {\n  width: 100%;\n}\n/* left side */\n.leftside {\n  padding-left: 1px;\n}\n/* right side */\n.rightside {\n  padding-right: 1px;\n}\nsetfilter .toggle.styleChecked {\n  color: var(--front1);\n  background: var(--accent1);\n}\nsetfilter .toggle.styleUnchecked {\n  color: var(--front0);\n  background: transparent;\n}\n',""]);const r=o},6682:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(8081),s=n.n(i),a=n(3645),o=n.n(a)()(s());o.push([e.id,"sets .infgrid {\n  display: flex;\n  flex-wrap: wrap;\n  height: 100%;\n}\nsets .grid-item {\n  width: 250px;\n}\n",""]);const r=o},254:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(8081),s=n.n(i),a=n(3645),o=n.n(a)()(s());o.push([e.id,"setsheet {\n  --sheetaccent: var(--accent1);\n  --sheetaccenthover: var(--accent0);\n  width: 250px;\n  min-height: 150px;\n  display: block;\n  margin: 5px;\n  padding: 5px;\n  background-color: var(--bs-body-bg);\n  border: 1px solid transparent;\n}\nsetsheet .itemCountChoice {\n  display: flex;\n  flex-wrap: wrap;\n}\nsetsheet .itemCountChoice .radioDark {\n  opacity: 0.9;\n  margin-right: 2px;\n}\nsetsheet .items {\n  flex-wrap: wrap;\n}\nsetsheet .itemIcon {\n  width: 40px;\n  height: 40px;\n  margin-right: 10px;\n}\nsetsheet .btn.btn-compare {\n  color: var(--bs-body-color);\n  background-color: var(--bs-body-bg);\n}\nsetsheet .btn.btn-compare:hover {\n  color: var(--bs-body-bg);\n  background-color: var(--bs-body-color);\n}\nsetsheet .statistics {\n  padding: 5px;\n}\nsetsheet .title {\n  padding: 5px;\n  font-size: 1.1rem;\n}\nsetsheet:hover {\n  border: 1px solid var(--sheetaccenthover);\n  z-index: 5;\n}\nsetsheet:hover .title {\n  color: var(--sheetaccenthover);\n}\nsetsheet .items {\n  display: flex;\n}\nsetsheet .items .item itemsheet {\n  /* Position the tooltip */\n  position: absolute;\n  visibility: collapse;\n  margin-left: -1px;\n  width: 260px;\n  background-color: var(--bg0);\n  pointer-events: none;\n  border: 1px solid var(--accent0);\n  z-index: 2;\n}\nsetsheet .items .item:hover itemsheet,\nsetsheet:hover .items .item:hover itemsheet {\n  visibility: visible;\n  opacity: 99%;\n}\nsetsheet .totalStats {\n  /* Position the tooltip */\n  position: absolute;\n  visibility: collapse;\n  padding-left: 5px;\n  margin-left: -1px;\n  width: 260px;\n  background-color: var(--bg0);\n  border: 1px solid var(--accent0);\n  border-top: none;\n  z-index: 1;\n}\nsetsheet:hover .totalStats {\n  visibility: visible;\n  opacity: 99%;\n}\n",""]);const r=o},9779:(e,t,n)=>{n.r(t),n.d(t,{itemsheet:()=>z});var i={};n.r(i),n.d(i,{default:()=>k,dependencies:()=>E,name:()=>I,register:()=>M,template:()=>C});var s=n(655),a=(n(1932),n(1542)),o=n(3379),r=n.n(o),d=n(7795),c=n.n(d),l=n(569),h=n.n(l),f=n(3565),p=n.n(f),m=n(9216),b=n.n(m),g=n(4589),u=n.n(g),v=n(3720),x={};x.styleTagTransform=u(),x.setAttributes=p(),x.insert=h().bind(null,"head"),x.domAPI=c(),x.insertStyleElement=b(),r()(v.Z,x),v.Z&&v.Z.locals&&v.Z.locals;var y=n(2303),w=n(6694);const I="itemsheet",C='\n\n\n\x3c!-- <template class.bind="renderClass"> --\x3e\n    <div if.bind="shouldRender" data-id="${item.id}" >\n        <div class="d-flex">\n            <img class="itemIcon" src="${itemIconUrl}" loading="lazy"/>\n            <div>\n                ${db.getI18n(item.nameId)}\n                <br>\n                <div class="d-flex">\n                    ${item.level} \n                    \x3c!-- Bouton pour comparer avec la dernière version --\x3e\n                    <button class="btn btn-compare" click.trigger="comparing = !comparing">\n                    <i class="fa-solid fa-code-compare"></i>\n                    </button>\n                </div>\n                \x3c!-- - ${item.id} --\x3e\n                \x3c!-- typeId --\x3e\n            </div>\n\n        </div>\n\n        \x3c!-- weapon stuff --\x3e\n        <div class="weaponConditions" if.bind="isWeapon">\n            \x3c!-- minrange, range, apCost, maxCastPerTurn, criticalHitProbability, criticalHitBonus  --\x3e\n            \x3c!-- castInDiagonal, castTestLos --\x3e\n            <div>${item.apCost}PA ${item.minRange}-${item.range}PO ${item.maxCastPerTurn}/t ${item.criticalHitProbability}% +${item.criticalHitBonus}</div>\n            <div></div>\n        </div>\n\n        \x3c!-- weapon effects --\x3e\n        \x3c!-- boost effects --\x3e\n        \x3c!-- <effectlist class="weaponEffects" if.bind="isWeapon" effects.bind="weaponEffects" iscrit.bind="false" sourcetype="weaponEffects" depth.bind="0"></effectlist>\n        <effectlist effects.bind="sortedEffects" iscrit.bind="false" sourcetype="itemEffects" depth.bind="0"></effectlist> --\x3e\n\n        \x3c!-- weapon effects --\x3e\n        \x3c!-- boost effects --\x3e\n        <template if.bind="comparing">\n            \x3c!-- <template if.bind="hasDifference"> --\x3e\n                <effectlist class="weaponEffects" if.bind="isWeapon" effects.bind="weaponEffects" iscrit.bind="false" sourcetype="weaponEffects" comparing.to-view="true" depth.bind="0"></effectlist>\n                <effectlist if.bind="finishedComparison" effects.bind="comparedEffects" iscrit.bind="false" sourcetype="itemEffects" comparing.to-view="true" depth.bind="0"></effectlist>\n            \x3c!-- </template>\n            <template else>\n                <div>Aucune modification</div>\n            </template> --\x3e\n        </template>\n        <template else>\n            <effectlist class="weaponEffects" if.bind="isWeapon" effects.bind="weaponEffects" iscrit.bind="false" sourcetype="weaponEffects" depth.bind="0"></effectlist>\n            <effectlist effects.bind="sortedEffects" iscrit.bind="false" sourcetype="itemEffects" depth.bind="0"></effectlist>\n        </template>\n\n\n        \x3c!-- conditions --\x3e\n        <div class="conditions" if.bind="hasConditions">\n            \x3c!-- "criteria": "CS>300&CI>300", --\x3e\n            ${getConditionsString()}\n        </div>\n\n    </div>\n\n\x3c!-- </template> --\x3e\n',k=C,E=[y,w];let S;function M(e){S||(S=a.b_N.define({name:I,template:C,dependencies:E})),e.register(S)}var $=n(7796),T=n(2013),j=n(232),P=n(5385),L=n(944),Z=n(9344);let z=class{constructor(e,t,n,i){this.i18n=n,this.ea=i,this.comparing=!1,this.finishedComparison=!1,this.db=e,this.conditionRenderer=t}binding(){setTimeout((()=>this.promiseComparison=this.loadComparison()),0)}async attached(){this.comparing&&await this.promiseComparison,this.ea.publish("itemsheet:loaded")}get itemIconUrl(){return this.db.gitFolderPath+"sprites/items/"+this.item.iconId+".png"}get sortedEffects(){return this.item.possibleEffects.filter((e=>!this.getEffect(e).useInFight))}getEffect(e){var t;return null!==(t=e.effect)&&void 0!==t||(e.effect=this.db.data.jsonEffectsById[e.effectId]),e.effect}get weaponEffects(){return this.item.possibleEffects.filter((e=>this.getEffect(e).useInFight))}get isWeapon(){return!!this.item.apCost||!!this.item.maxCastPerTurn}get hasConditions(){return this.item.criteria&&"null"!=this.item.criteria}getConditionsString(){let e="",t=j.Gw.parse(this.item.criteria);return e=JSON.stringify(t),this.conditionRenderer.render(t)}async loadComparison(){var e;if(this.comparedEffects=[],this.item.id in this.db.data2.jsonItemsById==0)return this.finishedComparison=!0,void(this.comparedEffects=this.sortedEffects);let t=this.db.data2.jsonItemsById[this.item.id];if(!t.possibleEffects[0].effect)for(let n of t.possibleEffects)null!==(e=n.effect)&&void 0!==e||(n.effect=this.db.data2.jsonEffectsById[n.effectId]);this.comparedEffects=[];for(let e of this.item.possibleEffects){if(!e)continue;let t=Object.assign({},e);this.comparedEffects[t.effectId]=t}for(let e of t.possibleEffects)if(e)if(e.effectId in this.comparedEffects){let t=this.comparedEffects[e.effectId];t.diceNum=t.diceNum-e.diceNum,t.diceSide=t.diceSide-e.diceSide}else{let t=Object.assign({},e);this.comparedEffects[t.effectId]=t,t.diceNum=0-e.diceNum,t.diceSide=0-e.diceSide}this.finishedComparison=!0}get shouldRender(){return!!this.item}get renderClass(){return this.shouldRender?"":"hiddensheet"}};(0,s.gn)([a.ExJ,(0,s.w6)("design:type",Object)],z.prototype,"item",void 0),(0,s.gn)([a.ExJ,(0,s.w6)("design:type",Boolean)],z.prototype,"comparing",void 0),(0,s.gn)([L.LO,(0,s.w6)("design:type",Boolean)],z.prototype,"finishedComparison",void 0),z=(0,s.gn)([(0,a.MoW)(i),(0,s.fM)(2,P.mb),(0,s.fM)(3,Z.Rp),(0,s.w6)("design:paramtypes",[T.db,$.A,Object,Object])],z)},25:(e,t,n)=>{n.r(t),n.d(t,{sets:()=>te});var i={};n.r(i),n.d(i,{default:()=>P,dependencies:()=>L,name:()=>T,register:()=>z,template:()=>j});var s={};n.r(s),n.d(s,{setsheet:()=>O});var a={};n.r(a),n.d(a,{default:()=>q,dependencies:()=>F,name:()=>W,register:()=>U,template:()=>R});var o={};n.r(o),n.d(o,{Setfilter:()=>G});var r={};n.r(r),n.d(r,{default:()=>V,dependencies:()=>X,name:()=>K,register:()=>ee,template:()=>Q});var d=n(655),c=(n(1932),n(1542)),l=n(3379),h=n.n(l),f=n(7795),p=n.n(f),m=n(569),b=n.n(m),g=n(3565),u=n.n(g),v=n(9216),x=n.n(v),y=n(4589),w=n.n(y),I=n(6682),C={};C.styleTagTransform=w(),C.setAttributes=u(),C.insert=b().bind(null,"head"),C.domAPI=p(),C.insertStyleElement=x(),h()(I.Z,C),I.Z&&I.Z.locals&&I.Z.locals;var k=n(9779),E=n(254),S={};S.styleTagTransform=w(),S.setAttributes=u(),S.insert=b().bind(null,"head"),S.domAPI=p(),S.insertStyleElement=x(),h()(E.Z,S),E.Z&&E.Z.locals&&E.Z.locals;var M=n(2303),$=n(6694);const T="setsheet",j='\n\n\n\n\n\x3c!-- englobing class div for css --\x3e\n<div class="setsheet" onmouseover.call="hoverSet()" ${hidden} id="${data.id}" ref="engdiv">\n\n  \x3c!-- Image and weapon stats --\x3e\n  <div class="title d-flex flex-nowrap">\n    \x3c!-- Name and level --\x3e\n    <div>\n      <span>${name} (${highestItemLevel})</span><br>\n    </div>\n  </div>\n\n  \x3c!-- items --\x3e\n  <div class="items" if.bind="items.length > 0">\n    <div class="item" repeat.for="item of data.items" onmouseover.call="hoverItem()">\n      <img class="itemIcon" src="${getImgUrl(item)}" loading="lazy"/>\n      \x3c!-- <itemsheet if.bind="finishedComparison" item.bind="items[$index]"></itemsheet> --\x3e\n    </div>\n  </div>\n\n  <div class="itemCountChoice">\n    \x3c!-- Sélection du nombre d\'items pour choisir le bonus pano --\x3e\n    <div repeat.for="i of data.effects.length">\n      <input type="radio" class="btn-check" name="${data.id}" id="${data.id}-${i}" model.bind="i" checked.bind="bonusCounter" autocomplete="off">\n      <label class="btn btn-outline-dark radioDark" style="margin-left: auto;" for="${data.id}-${i}">${i + 1}</label>\n    </div>\n    \x3c!-- Bouton pour comparer avec la dernière version --\x3e\n    <button class="btn btn-compare" click.trigger="comparing = !comparing">\n      <i class="fa-solid fa-code-compare"></i>\n    </button>\n  </div>\n\n  \x3c!-- Effects --\x3e\n  <template if.bind="comparing">\n    \x3c!-- hi ${finishedComparison} ${comparing} --\x3e\n    \x3c!-- <div if.bind="!finishedComparison" class="loaderContainer">\n        <div class="loader"></div>\n    </div> --\x3e\n    <effectlist if.bind="finishedComparison" effects.bind="comparedEffects[bonusCounter]" sourcetype="itemEffects" iscrit.bind="false" depth.bind="0" comparing.to-view="true"></effectlist>\n  </template>\n  <template else>\n    \x3c!-- bye --\x3e\n    <effectlist if.bind="bonusCounterHasEffects" effects.bind="data.effects[bonusCounter]" sourcetype="itemEffects" iscrit.bind="false" depth.bind="0"></effectlist>\n  </template>\n\n  \n  \x3c!-- Effects totals --\x3e\n  \x3c!-- <div class="totalStats">\n    <ul style="padding: 0;">\n      <li class="row" repeat.for="effect of data.statistics" if="isntPseudo(effect)">\n        <div class="container statistic">\n          ${effect.min}\n          ${effect.min == null ? "" : "à"}\n          ${effect.max}\n          <span style.bind="getStatColor(effect.name)">${effect.name}</span>\n        </div>\n      </li>\n    </ul>\n  </div> --\x3e\n\n</div>\n',P=j,L=[k,M,$];let Z;function z(e){Z||(Z=c.b_N.define({name:T,template:j,dependencies:L})),e.register(Z)}var D=n(9344),A=n(2013),N=n(5385);let O=class{constructor(e,t,n){this.i18n=t,this.ea=n,this.comparing=!1,this.hidden="hidden",this.bonusCounter=1,this.items=[],this.finishedLinkingItems=!1,this.finishedComparison=!1,this.db=e}isntPseudo(e){return e.name.includes("(isntPseudo)")}binding(){this.bonusCounter=this.data.effects.length-1,setTimeout((()=>this.promiseItems=this.linkItems()),0),setTimeout((()=>this.promiseComparison=this.loadComparison()),0)}async attached(){await this.promiseItems,await this.promiseComparison,this.ea.publish("setsheet:loaded",this.engdiv.parentElement),this.hidden=""}async linkItems(){for(let e of this.data.items){if(null==e)continue;let t=this.getItem(e);null!=t&&this.items.push(t)}this.finishedLinkingItems=!0}hoverSet(){}hoverItem(){}getItem(e){return this.db.data.jsonItemsById[e]}getImgUrl(e){let t=this.getItem(e);return this.db.gitFolderPath+"sprites/items/"+t.iconId+".png"}get name(){return this.db.getI18n(this.data.nameId)}get bonusCounterHasEffects(){let e=this.data.effects;if(this.bonusCounter in e){let t=e[this.bonusCounter];return t.length>0&&null!=t[0]}return!1}get highestItemLevel(){return this.db.data.highestItemLevel(this.data)}async loadComparison(){if(this.comparedEffects=[],this.data.id in this.db.data2.jsonItemSetsById==0)return this.finishedComparison=!0,void(this.comparedEffects=this.data.effects);let e=this.db.data2.jsonItemSetsById[this.data.id];for(let t=0;t<this.data.effects.length;t++){this.comparedEffects[t]=[];for(let e of this.data.effects[t]){if(!e)continue;let n=Object.assign({},e);this.comparedEffects[t][n.effectId]=n}for(let n of e.effects[t])if(n)if(n.effectId in this.comparedEffects[t]){let e=this.comparedEffects[t][n.effectId];e.diceNum=e.diceNum-n.diceNum,e.diceSide=e.diceSide-n.diceSide}else{let e=Object.assign({},n);this.comparedEffects[t][e.effectId]=e,e.diceNum=0-n.diceNum,e.diceSide=0-n.diceSide}}this.finishedComparison=!0}};(0,d.gn)([c.ExJ,(0,d.w6)("design:type",Object)],O.prototype,"data",void 0),(0,d.gn)([c.ExJ,(0,d.w6)("design:type",Boolean)],O.prototype,"comparing",void 0),O=(0,d.gn)([(0,c.MoW)(i),(0,d.fM)(1,N.mb),(0,d.fM)(2,D.Rp),(0,d.w6)("design:paramtypes",[A.db,Object,Object])],O);var B=n(6491),H={};H.styleTagTransform=w(),H.setAttributes=u(),H.insert=b().bind(null,"head"),H.domAPI=p(),H.insertStyleElement=x(),h()(B.Z,H),B.Z&&B.Z.locals&&B.Z.locals;const W="setfilter",R='\x3c!-- Search --\x3e\n<div class="row" if.bind="db.isLoaded">\n  <input class="search" type="text" value.bind="filterText" t="[placeholder]quickfus.filter.search" focus="true" change.delegate="filterTextChanged()" />\n</div>\n\n\x3c!-- Level --\x3e\n<div class="d-flex align-items-center">\n  \x3c!-- <input class="checkbox mr-1" type="checkbox" id="level" checked.bind="filterLevel" /> --\x3e\n  <label class="title mr-auto" for="level" t="quickfus.filter.level"></label>\n  <input class="mr-2" type="number" value.bind="levelMin" placeholder="min" change.delegate="levelMinChanged()" />\n  <input class="" type="number" value.bind="levelMax" placeholder="max" change.delegate="levelMaxChanged()" />\n</div>\n',q=R,F=[];let J;function U(e){J||(J=c.b_N.define({name:W,template:R,dependencies:F})),e.register(J)}var _=n(7296);let G=class{constructor(e,t){this.db=e,this.ea=t,this.filterText="",this.levelMin=1,this.levelMax=200,this.debouncedSearch=_.D5.debounce((()=>this.search()),700,!1),this.db.isLoaded?this.onLoad():this.ea.subscribe("db:loaded",(()=>{this.onLoad()}))}onLoad(){this.search()}search(){console.log("search sets"),this.ea.publish("sets:search",this)}levelMinChanged(e,t){console.log("mmin changed"),this.debouncedSearch()}levelMaxChanged(e,t){console.log("max changed"),this.debouncedSearch()}filterTextChanged(e,t){console.log("text changed"),this.debouncedSearch()}};G=(0,d.gn)([(0,c.MoW)(a),(0,d.fM)(1,D.Rp),(0,d.w6)("design:paramtypes",[A.db,Object])],G);const K="sets",Q='\n\n\x3c!-- <require from="./sets.less"></require> --\x3e\n\x3c!-- <require from="../../components/mason.css"></require> --\x3e\n\n<setfilter></setfilter>\n\n\x3c!-- Filtres --\x3e\n\x3c!-- <setfilter filter.bind="filter"></setfilter> --\x3e\n\n<div if.bind="searching" class="loaderContainer">\n    <div class="loader"></div>\n</div>\n\n<p></p>\n\n<button class="btn" click.trigger="toggleComparing()">Comparer avec la maj précédente</button>\n\n\n<div class="grid-wrapper">\n    <div class="grid" ref="grid">\n        <setsheet class="grid-item" repeat.for="set of mason.data" data.bind="set" comparing.bind="comparing"></setsheet>\n    </div>\n</div>\n\n\x3c!-- <div class="infgrid">\n  <setsheet repeat.for="set of mason.data" data.bind="set"></setsheet>\n</div>\n<button class="" click.trigger="showMore()">Load</button> --\x3e\n',V=Q,X=[s,o];let Y;function ee(e){Y||(Y=c.b_N.define({name:K,template:Q,dependencies:X})),e.register(Y)}n(9996);let te=class{constructor(e,t){this.db=e,this.ea=t,this.debouncedShowMore=_.D5.debounce((()=>{this.mason.showMore()}),500,!0),this.comparing=!1,this.searching=!0,this.mason=new _.Ix,this.mason.itemsPerPage=20;let n=_.D5.debounce((()=>{this.mason.reloadMsnry()}),200,!1);this.ea.subscribe("setsheet:loaded",(e=>{n()})),this.ea.subscribe("sets:search",(e=>this.search(e)))}isLoaded(){return this.db.isLoaded}attached(){console.log("sets attached grid: "+this.grid),this.mason.obj=this,this.mason.initMasonry(),this.pageHost=document.getElementsByClassName("page-host")[0];let e=t=>{this.grid?setTimeout((()=>this.onScroll(t))):this.pageHost.removeEventListener("scroll",e,!1)};this.pageHost.addEventListener("scroll",e)}async onScroll(e){let t=this.pageHost.clientHeight,n=this.grid.scrollHeight+this.grid.offsetTop-t,i=this.pageHost.scrollTop;Math.abs(i-n)<=15&&this.debouncedShowMore()}async search(e=null){this.mason.data=[],this.mason.fulldata=[],this.mason.page=0,this.filterData(e),this.mason.showMore(),this.mason.showMore(),this.mason.showMore(),this.mason.showMore(),this.searching=!1}async showMore(){this.mason.showMore()}filterData(e){let t=this.db.data.jsonItemSets.filter((t=>{if(this.highestItemLevel(t)<e.levelMin)return!1;if(this.highestItemLevel(t)>e.levelMax)return!1;if(e.filterText&&""!=e.filterText.trim()){let n=new RegExp(_.D5.caseAndAccentInsensitive(e.filterText.trim()),"i"),i=this.db.getI18n(t.nameId);if(!n.test(i))return!1}return!0})).map((e=>{var t;if(e.itemsData||(e.itemsData=[]),0==(null===(t=e.itemsData)||void 0===t?void 0:t.length)){let t=e.items.map((e=>this.db.data.jsonItemsById[e])).filter((e=>null!=e));e.itemsData=t}return e})).filter(((e,t,n)=>e.effects.length>0)).sort(((e,t)=>{let n=this.highestItemLevel(t)-this.highestItemLevel(e);return 0!=n?n:t.id-e.id}));this.mason.fulldata.push(...t)}highestItemLevel(e){if(!e.itemsData)return 0;let t=e.itemsData.map((e=>e.level));return Math.max(...t)}async toggleComparing(){this.comparing=!this.comparing}};te=(0,d.gn)([(0,c.MoW)(r),(0,D.f3)(A.db),(0,d.fM)(1,D.Rp),(0,d.w6)("design:paramtypes",[A.db,Object])],te)},7296:(e,t,n)=>{n.d(t,{D5:()=>o,Ix:()=>a}),n(48);var i=n(8751),s=n.n(i);class a{constructor(){this.fulldata=[],this.data=[],this.page=0,this.itemsPerPage=30}async showMore(){let e=this.page*this.itemsPerPage,t=this.fulldata.slice(e,e+this.itemsPerPage);this.data.push(...t),this.page++}async append(e){this.msnry.appended([e])}async reloadMsnry(){this.msnry&&(this.msnry.reloadItems(),this.msnry.layout())}initMasonry(){console.log("mason init grid: "+this.obj.grid),this.obj.grid&&(this.msnry&&this.msnry.destroy(),this.msnry=new(s())(this.obj.grid,{itemSelector:".grid-item",columnWidth:".grid-item",horizontalOrder:!0,gutter:10,fitWidth:!0,transitionDuration:0}),this.msnry.layout())}}class o{static caseAndAccentInsensitive(e){const t=function(e){let t={};for(;e.length>0;){let n="["+e.shift()+"]",i=n.split("");for(;i.length>0;)t[i.shift()]=n}return t}(["aàáâãäå","cç","eèéêë","iìíîï","nñ","oòóôõöø","sß","uùúûü","yÿ"]);return function(e){var n="";if(!e)return n;e=e.toLowerCase();for(var i=0;i<e.length;i++){let s=e.charAt(i);n+=t[s]||s}return n}(e)}static debounce(e,t,n){var i;return function(){var s=this,a=arguments,o=n&&!i;clearTimeout(i),i=setTimeout((()=>{i=null,n||e.apply(s,a)}),t),o&&e.apply(s,a)}}}}}]);