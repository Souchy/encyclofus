<import from="./summon"></import>

<!-- Spell Description -->
<div class="spellDescription">
	<!-- name -->
	<h5 if.bind="!issummon">${name}</h5>
	<h6 if.bind="issummon">
		<img src="${db.getSpellIconPath(spellid)}" style="width: 28px; height: 28px;" />
		${name} 
	</h6>
	
	<span>
		${spell.apCost} <span t="pa"></span> <span style.bind="db.getModIconStyle(' pa ') + 'display: inline-block;'"></span> /
	</span>
	<span>
		${spell.minRange} - ${spell.range} <span t="po"></span> 
		<img if.bind="spell.rangeCanBeBoosted" src="${db.getIconPath('icons/editable_range.webp')}"/>
		<img if.bind="!spell.rangeCanBeBoosted" src="${db.getIconPath('icons/fixed_range.webp')}"/>
	</span>

	<!-- description -->
	<p style="white-space: pre-line;">${description}</p>

	<!-- effects -->
	<div class="d-flex effects">
		<!-- normal -->
		<div class="effectsNormal">
			<h6>Effets</h6>
			<table class="table table-striped table-sm table-borderless ">
				<tbody>
					<tr repeat.for="e of spell.effects" if.bind="e.visibleInTooltip">
						<td style="vertical-align: middle;">${renderEffectI18n(e)}</td>
						<td style.bind="getIcon(e)"></td>
						<td style.bind="db.getAoeIconStyle(e)"></td>
					</tr>

					<!-- <tr if.bind="hasSummon(e)">
						<td>${getSummon(e)}</td>
					</tr> -->
					<!-- <an-effect repeat.for="e of spell.effects" if.bind="e.visibleInTooltip" e.bind="e"
						text.bind="renderEffectI18n(e)" summon.bind="getSummon(e)"></an-effect> -->
					<!-- <tr repeat.for="e of spell.effects" if.bind="hasSummon(e)">
						<td>${getSummon(e)}</td>
					</tr> -->
					<!-- <tr repeat.for="i of detailsObj.effects.length" height="32px;" if.bind="detailsObj">
						<td class="">
							${removeFighterIconTag(detailsObj.effects[i])}
						</td>
						<td class="" style.bind="getFighterIcon(detailsObj.effects[i])"></td>
						<td class="" style.bind="getIcon(detailsObj.effects[i])"></td>
					</tr> -->
				</tbody>
			</table>
		</div>
		<!-- critiques -->
		<div class="effectsCrit">
			<h6>Effets critiques</h6>
			<table class="table table-striped table-sm table-borderless ">
				<tbody>
					<tr repeat.for="e of spell.criticalEffect" if.bind="e.visibleInTooltip">
						<td style="vertical-align: middle;">${renderEffectI18n(e)}</td>
						<td style.bind="getIcon(e)"></td>
						<td style.bind="db.getAoeIconStyle(e)"></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<!-- other -->
	<div>
		<h6>Autres caractéristiques</h6>
		<div class="d-flex">
			<!-- <table-details polarity.bind="'$even'" spell.bind="spell" style="width:45%; margin-right: auto;"></table-details>
			<table-details polarity.bind="'$odd'" spell.bind="spell" style="width:45%; margin-right: auto; height: auto; margin-bottom: auto;"></table-details> -->
			
			<table class="table table-striped table-sm table-borderless" style="width:45%; margin-right: auto; margin-bottom: auto">
				<tbody>
					<tr if.bind="spell.criticalHitProbability">
						<td>Probabilité de coup critique</td>
						<td style="white-space: nowrap; text-align: right;">${spell.criticalHitProbability}%</td>
					</tr>
					<tr if.bind="spell.maxCastPerTurn">
						<td>Utilisations par tour</td>
						<td style="white-space: nowrap; text-align: right;">${spell.maxCastPerTurn}</td>
					</tr>
					<tr if.bind="spell.maxCastPerTarget">
						<td>Nb. de lancers par tour par joueur</td>
						<td style="white-space: nowrap; text-align: right;">${spell.maxCastPerTarget}</td>
					</tr>
					<tr if.bind="spell.minCastInterval">
						<td>Intervalle de relance</td>
						<td style="white-space: nowrap; text-align: right;">${spell.minCastInterval}</td>
					</tr>
					<tr if.bind="spell.initialCooldown">
						<td>Intervalle de relance initial</td>
						<td style="white-space: nowrap; text-align: right;">${spell.initialCooldown}</td>
					</tr>
					<tr if.bind="spell.globalCooldown">
						<td>Intervalle de relance global</td>
						<td style="white-space: nowrap; text-align: right;">${spell.globalCooldown ? "Oui" : "Non"}</td>
					</tr>
				</tbody>
			</table>
			<table class="table table-striped table-sm table-borderless" style="width:45%; margin-right: auto; height: auto; margin-bottom: auto;">
				<tbody>
					<tr if.bind="spell.castTestLos">
						<td>Ligne de vue</td>
						<td style="white-space: nowrap; text-align: right;">${spell.castTestLos ? "Oui" : "Non"}</td>
					</tr>
					<tr if.bind="spell.needFreeCell">
						<td>Cellule libre</td>
						<td style="white-space: nowrap; text-align: right;">${spell.needFreeCell ? "Oui" : "Non"}</td>
					</tr>
					<tr if.bind="spell.needTakenCell">
						<td>Cellule pleine</td>
						<td style="white-space: nowrap; text-align: right;">${spell.needTakenCell ? "Oui" : "Non"}</td>
					</tr>
					<tr if.bind="spell.castInLine">
						<td>Lancer en ligne</td>
						<td style="white-space: nowrap; text-align: right;">${spell.castInLine ? "Oui" : "Non"}</td>
					</tr>
					<tr if.bind="spell.castInDiagonal">
						<td>Lancer en diagonale</td>
						<td style="white-space: nowrap; text-align: right;">${spell.castInDiagonal ? "Oui" : "Non"}</td>
					</tr>
					<tr if.bind="spell.maxStack > 0">
						<td>Cumul max. des effets</td>
						<td style="white-space: nowrap; text-align: right;">${spell.maxStack}</td>
					</tr>
					<!-- <tr if.bind="spell.needFreeTrapCell">
						<td>Cellule libre de pièges</td>
						<td style="white-space: nowrap; text-align: right;">${spell.needFreeTrapCell ? "Oui" : "Non"}</td>
					</tr> -->
				</tbody>
			</table>
		</div>
	</div> 

	<!-- détails additionels -->
	<div if.bind="detailsObj.text">
		<h6>Détails additionnels</h6>
		<p if.bind="detailsObj.text">${detailsObj.text}</p>
	</div>

</div> <!-- fin info sort -->

<div repeat.for="e of spell.effects" if.bind="hasSummon(e)">
	<summon summon.bind="getSummon(e)"></summon>
</div>

<!-- custom template pour les Autres Caractéristiques -->
<template as-custom-element="table-details">
	<bindable property="spell"></bindable>
	<bindable property="polarity"></bindable>
	<table class="table table-striped table-sm table-borderless">
		<tbody>
			<!-- <tr repeat.for="i of spell.details.length" if.bind="(polarity == '$even' && $even) || (polarity == '$odd' && $odd)">
				<td class="">
					${spell.details[i].effect}
				</td>
				<td class="" style="white-space: nowrap; text-align: right;">${
					spell.details[i].val.includes('static') ?
					spell.details[i].info :
					spell.details[i].val
					}</td>
			</tr> -->
		</tbody>
	</table>
</template>


